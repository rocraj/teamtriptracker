<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Error Alert -->
  <app-alert
    *ngIf="error"
    [message]="error"
    [type]="'error'"
    [visible]="!!error"
  ></app-alert>

  <!-- Loading State -->
  <app-loading *ngIf="loading"></app-loading>

  <!-- Create Team Modal -->
  <app-create-team-modal
    [isOpen]="showCreateTeamModal"
    (close)="onCloseCreateTeamModal()"
    (teamCreated)="onTeamCreated($event)"
  ></app-create-team-modal>

  <!-- Main Content -->
  <div *ngIf="!loading" class="space-y-8">
    <!-- Welcome Section -->
    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 sm:p-8 text-white">
      <h1 class="text-3xl sm:text-4xl font-bold mb-2">Welcome back, {{ currentUser?.name }}! ğŸ‘‹</h1>
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <p class="text-blue-100 mb-4 sm:mb-0">You have {{ teams.length }} active teams</p>
        <div class="bg-white/10 rounded-lg p-4">
          <p class="text-blue-100 text-sm">Your Total Balance</p>
          <p [class]="'text-2xl font-bold ' + (totalNetBalance >= 0 ? 'text-green-200' : 'text-red-200')">
            {{ totalNetBalance >= 0 ? '+' : '' }}â‚¹{{ totalNetBalance | number:'1.2-2' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <button
        (click)="createNewTeam()"
        class="px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition flex items-center justify-center space-x-2"
      >
        <span>â•</span>
        <span>Create New Team</span>
      </button>
      <button
        *ngIf="teams.length > 0"
        (click)="goToTeam(teams[0].id)"
        class="px-6 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition flex items-center justify-center space-x-2"
      >
        <span>ğŸ‘¥</span>
        <span>Go to Latest Team</span>
      </button>
    </div>

    <!-- Your Teams Section -->
    <div>
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Your Teams</h2>
      <div *ngIf="teams.length > 0; else noTeams" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div *ngFor="let team of teams" class="bg-white rounded-lg shadow-md p-6 border cursor-pointer hover:shadow-lg transition-shadow" (click)="goToTeam(team.id)">
          <div class="flex items-start justify-between mb-4">
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ team.name }}</h3>
              <p class="text-sm text-gray-600">{{ team.member_count }} members</p>
              <p *ngIf="team.trip_budget" class="text-sm text-gray-500 mt-1">Budget: â‚¹{{ team.trip_budget | number:'1.2-2' }}</p>
            </div>
            <span class="text-2xl">ğŸ‘¥</span>
          </div>
          
          <div class="border-t pt-4" *ngIf="userWalletData[team.id]">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-600">Your Balance:</span>
              <span [class]="'font-semibold ' + (userWalletData[team.id].current_balance >= 0 ? 'text-green-600' : 'text-red-600')">
                {{ userWalletData[team.id].current_balance >= 0 ? '+' : '' }}â‚¹{{ userWalletData[team.id].current_balance | number:'1.2-2' }}
              </span>
            </div>
            <div class="mt-2" *ngIf="userWalletData[team.id].is_over_budget">
              <span class="text-xs text-red-500 bg-red-50 px-2 py-1 rounded">âš ï¸ Over Budget</span>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noTeams>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-8 text-center">
          <p class="text-gray-600 mb-4">No teams yet. Create one to get started!</p>
          <button
            (click)="createNewTeam()"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
          >
            Create First Team
          </button>
        </div>
      </ng-template>
    </div>

    <!-- Recent Expenses Section -->
    <div *ngIf="recentExpenses.length > 0">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Recent Expenses</h2>
      <div class="space-y-3">
        <div *ngFor="let expense of recentExpenses" class="bg-white rounded-lg shadow-md p-4 sm:p-6 border-l-4 border-blue-400">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center space-x-2 mb-2">
                <span class="text-2xl">{{ expense.category?.emoji || expense.team_category?.emoji || 'ğŸ’°' }}</span>
                <h4 class="text-lg font-semibold text-gray-900">{{ expense.category?.name || expense.team_category?.name || 'Expense' }}</h4>
              </div>
              <p *ngIf="expense.note" class="text-sm text-gray-600">{{ expense.note }}</p>
              <p class="text-xs text-gray-500 mt-2">{{ getRelativeTime(expense.created_at) }}</p>
              <p class="text-xs text-gray-500">Paid by: {{ getPersonalizedUserName(expense.payer_id) }}</p>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold text-gray-900">â‚¹{{ expense.total_amount | number:'1.2-2' }}</p>
              <p class="text-xs text-gray-500">{{ expense.participants.length }} participants</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
